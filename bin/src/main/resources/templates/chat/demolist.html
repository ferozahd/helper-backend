<!doctype html>
<html lang="en" ang="en" xmlns:th="http://www.w3.org/1999/xhtml" xmlns:sec="http://www.w3.org/1999/xhtml">

<head th:replace="common/header :: common-header"></head>


<body>

    <!-- Wrapper -->
    <div id="wrapper">

        <!-- Header Container
    ================================================== -->
        <header id="header-container" class="fullwidth" th:replace="common/header :: navbar">
        </header>
        <div class="clearfix"></div>
        <!-- Header Container / End -->

        <!-- Messages -->



        <!-- Dashboard Container -->
        <div class="dashboard-container">

            <!-- Dashboard Sidebar
    ================================================== -->
            <div class="dashboard-sidebar">
                <div class="dashboard-sidebar-inner" data-simplebar>
                    <div class="dashboard-nav-container">

                        <!-- Responsive Navigation Trigger -->
                        <a href="#" class="dashboard-responsive-nav-trigger">
                            <span class="hamburger hamburger--collapse">
                                <span class="hamburger-box">
                                    <span class="hamburger-inner"></span>
                                </span>
                            </span>
                            <span class="trigger-title">Dashboard Navigation </span>
                        </a>

                        <!-- Navigation -->
                        <div class="dashboard-nav">
                            <div class="dashboard-nav-inner">

                                <ul data-submenu-title="Start">
                                    <li><a href="dashboard.html"><i class="icon-material-outline-dashboard"></i>
                                            Dashboard</a></li>
                                    <li class="active"><a href="dashboard-messages.html"><i
                                                class="icon-material-outline-question-answer"></i> Messages <span
                                                class="nav-tag">2</span></a></li>
                                    <li><a href="dashboard-bookmarks.html"><i
                                                class="icon-material-outline-star-border"></i> Bookmarks</a></li>
                                    <li><a href="dashboard-reviews.html"><i
                                                class="icon-material-outline-rate-review"></i> Reviews</a></li>
                                </ul>

                                <ul data-submenu-title="Organize and Manage">
                                    <li><a href="#"><i class="icon-material-outline-business-center"></i> Jobs</a>
                                        <ul>
                                            <li><a href="dashboard-manage-jobs.html">Manage Jobs <span
                                                        class="nav-tag">3</span></a></li>
                                            <li><a href="dashboard-manage-candidates.html">Manage Candidates</a></li>
                                            <li><a href="dashboard-post-a-job.html">Post a Job</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="#"><i class="icon-material-outline-assignment"></i> Tasks</a>
                                        <ul>
                                            <li><a href="dashboard-manage-tasks.html">Manage Tasks <span
                                                        class="nav-tag">2</span></a></li>
                                            <li><a href="dashboard-manage-bidders.html">Manage Bidders</a></li>
                                            <li><a href="dashboard-my-active-bids.html">My Active Bids <span
                                                        class="nav-tag">4</span></a></li>
                                            <li><a href="dashboard-post-a-task.html">Post a Task</a></li>
                                        </ul>
                                    </li>
                                </ul>

                                <ul data-submenu-title="Account">
                                    <li><a href="dashboard-settings.html"><i class="icon-material-outline-settings"></i>
                                            Settings</a></li>
                                    <li><a th.href="@{index-logged-out.html}"><i
                                                class="icon-material-outline-power-settings-new"></i> Logout</a></li>
                                </ul>

                            </div>
                        </div>
                        <!-- Navigation / End -->

                    </div>
                </div>
            </div>
            <div class="dashboard-content-container" data-simplebar>
                <div class="dashboard-content-inner">
                    <ul>
                        <ul class="list-group" id="userlist">

                        </ul>
                    </ul>

                </div>
            </div>
        </div>
    </div>
    ================================================== -->
    <div id="footer" th:replace="common/header :: footer"></div>


    <!-- Scripts
        ================================================== -->
    <script src="/js/jquery-3.6.0.min.js"></script>
    <script src="/js/jquery-migrate-3.3.2.min.js"></script>
    <script src="/js/mmenu.min.js"></script>
    <script src="/js/tippy.all.min.js"></script>
    <script src="/js/simplebar.min.js"></script>
    <script src="/js/bootstrap-slider.min.js"></script>
    <script src="/js/bootstrap-select.min.js"></script>
    <script src="/js/snackbar.js"></script>
    <script src="/js/clipboard.min.js"></script>
    <script src="/js/counterup.min.js"></script>
    <script src="/js/magnific-popup.min.js"></script>
    <script src="/js/slick.min.js"></script>
    <script src="/js/custom.js"></script>

    <script th:inline="javascript">

        const userid =/*[[${userid}]]*/ 'default';

        window.onload = async function () {

            $.ajax({
                type: "POST",
                url: "/api/chat/getallusers",
                // data: {},
                success: async function (result) {
                    result.forEach(element => {

                        if (element.id != userid) {
                            let li = document.createElement("li");
                            li.classList.add("list-group-item");
                            li.innerHTML =
                                "<h2>" + element.username + '</h2><form method="post" action="/api/chat/sendmessage"><input name="destinationId" type="hidden" value="' + element.id + '"" /><input type="text" name="messagebody" /><input type="submit" value="send"/></form>';
                            $("#userlist").append(li);
                        }
                    });

                }
            });

     
            // const messageForm = document.querySelector("form");
            // messageForm.addEventListener("submit", function(event){
            //     event.preventDefault();
            //     alert("clicked")
            //     console.log(event)
            // });
            // messageForm.onsubmit = function (event) {
            //     event.preventDefault();
            //     if ($("#message_body").val().length != 0) {
            //         $.ajax({
            //             type: "POST",
            //             url: "/api/chat/sendmessage",
            //             data: {
            //                 destinationId: $("#destinationId").val(),
            //                 messagebody: $("#message_body").val()
            //             },
            //             success: async function (result) {
            //                 console.log(result)
            //                 // if (result !== null)
            //                 //     window.location = "/chat/"
            //             }
            //         });
            //     }
            // }
        }
    </script>



</body>

</html>